<!--

	dataEditor. Show data in JSON format
    Copyright (C) 2016  D. H. B. Marcos.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see http://www.gnu.org/licenses/.

--!>
<HTML>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="w3.css">
	
	<script>
		
		window.onerror = function(msg, url, linenumber) {
    		alert('Error message: ' + msg + '\nURL: ' + url + '\nLine Number: ' + linenumber);
    		return true;
		};
		
		function println(text) {
			 document.getElementById("data").innerHTML += text + "</br>\n";
		};
		
		function showString(str) {
			return "\"" + str + "\"\n";
		}
		
		function showNumber(number) {
			return number + "\n";
		}
		
		function showArray(arr) {
			var text = "<ol>\n";
			for(element in arr) {
				text += ("<li>" + parseElement(arr[element]) + "</li>\n");
			};
			return text + ("</ol>\n");
		};
		
		function showObject(obj) {
			var text = "<ul>\n";
			for(element in obj) {
				text += ("<li>" + element + ": " + parseElement(obj[element]) + "</li>\n");
			};
			return text + ("</ul>\n");
		};
		
		function parseElement(element) {
			
			if(typeof(element) == "object") {
				if(Array.isArray(element)) {
					return showArray(element);
				} else {
					return showObject(element);
				};
			};
			
			if(typeof(element) == "string") {
				return showString(element);
			};
			
			if(typeof(element) == "number") {
				return showNumber(element);
			};
		};

		function loadJSON(file, callback) {   
			var xobj = new XMLHttpRequest();
			xobj.overrideMimeType("application/json");
			xobj.open('GET', file, true); // Replace 'my_data' with the path to your file
			xobj.onreadystatechange = function () {
				if (xobj.readyState == 4 && xobj.status == "200") {
            		// Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
					callback(xobj.responseText);
				}
			};
			xobj.send(null);  
		};
 
		function loadData(file) {
			loadJSON (
				file, function(response) {
					var actual_JSON = JSON.parse(response);
			
					println(parseElement(actual_JSON));
				}
			);
    	};
    
    	function load() {
			var fileName = document.location.search;
			if (fileName == "") {
				document.getElementById("title").innerHTML = "dataEditor";
				document.getElementById("data").innerHTML = "<p>Put a \"?\" character in the end of this URL and add the location of JSON format file.</p>";
				document.getElementById("data").innerHTML += "<p>For sample:</p>";
				document.getElementById("data").innerHTML += "<div class=\"w3-blockquote\"><p>http://172.0.0.1/dataEditor.html<b>?sample.json</b></p></div>";
				document.getElementById("data").innerHTML += "<p>Clone this in <a href=\"https://github.com/dhbmarcos/dataEditor\">github.com/dhbmarcos/dataEditor</a>.</p>";
			} else {
				fileName = fileName.substr(1);
				document.getElementById("title").innerHTML = fileName.slice(0, -5);
				loadData(fileName);
			};
		};
	</script>
	</head>
    <body onload="load()">
    	<header class="w3-container w3-blue">
			<h1><div id="title"/></h1>
		</header>
		<article class="w3-container"> 
			<p><div id="data"/></p>
		</article>
		<footer class="w3-container w3-grey w3-tiny">
			<h5>dataEditor</h5>
			<p><i>dataEditor  Copyright (C) 2016  D. H. B. Marcos</br>
			   This program comes with ABSOLUTELY NO WARRANTY;
			   This is free software, and you are welcome to
			   redistribute it under certain conditions;
    		   See <a href="https://github.com/dhbmarcos/dataEditor/blob/master/LICENSE">here</a> for details.</i></p>
		</footer> 
    </body>
<html>
